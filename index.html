<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Organizador de Resultados Laboratoriais</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; min-height: 100vh; margin: 0; box-sizing: border-box; }
    textarea { width: 100%; height: 150px; font-size: 16px; }
    pre { background: #fff; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; height: 120px; overflow-y: auto; font-size: 16px; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; margin-right: 10px; cursor: pointer; }
    .footer-credit { position: fixed; bottom: 5px; right: 10px; font-size: 11px; color: #888; font-style: italic; user-select: none; opacity: 0.6; }
  </style>
</head>
<body>

<h2>Organizador de Resultados Laboratoriais</h2>
<textarea id="entrada" placeholder="Cole os resultados aqui..."></textarea><br>
<button onclick="processar()">Organizar</button>
<button onclick="copiar()">Copiar Resultado</button>
<h3>Resultado Formatado:</h3>
<pre id="saida">Nenhum valor reconhecido.</pre>

<script>
const sinonimos = {
  'HB': ['hb', 'hemoglobina'],
  'HCT': ['hct', 'hematocrito', 'hematócrito'],
  'LEUCO': ['leuco', 'leucocitos', 'leucócitos'],
  'PLT': ['plt', 'plaquetas', 'plq'],
  'INR': ['inr', 'rni'],
  'TTPA': ['ttpa', 'tempo tromboplastina parcial ativada'],
  'TAP': ['tap', 'atividade de protrombina'],
  'RR': ['rr', 'ratio', 'rátio', 'relação paciente/normal'],
  'U': ['ureia', 'urea', 'u'],
  'CR': ['creatinina', 'crea', 'cr'],
  'NA': ['na', 'sodio', 'sódio'],
  'K': ['k', 'potassio', 'potássio'],
  'PCR': ['pcr', 'proteina c reativa', 'proteína c reativa'],
  'GLI': ['glicose', 'glucose', 'gli', 'glicemia'],
  'AST': ['tgo', 'ast'],
  'ALT': ['tgp', 'alt'],
  'TSH': ['tsh'],
  'T4': ['t4', 'tiroxina'],
  'T3': ['t3', 'tri-iodotironina']
};

function removerAcentos(texto) {
  return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
}

function normalizarTexto(texto) {
  return removerAcentos(texto.toLowerCase()).replace(/[^a-z0-9]/g, '');
}

function encontrarSigla(chave) {
  const chaveNormalizada = normalizarTexto(chave);
  for (let sigla in sinonimos) {
    for (const s of sinonimos[sigla]) {
      if (chaveNormalizada === normalizarTexto(s)) {
        return sigla;
      }
    }
  }
  return null;
}

function removerDatas(texto) {
  return texto.replace(/\b\d{1,2}\/\d{1,2}(\/\d{2,4})?\b/g, '');
}

function processar() {
  let entrada = document.getElementById('entrada').value;
  entrada = removerDatas(entrada);
  entrada = entrada.replace(/\r?\n|\r/g, ' ');  // Substitui quebras de linha por espaço

  let palavras = entrada.split(/\s+/);
  let mapa = {};

  for (let i = 0; i < palavras.length; i++) {
    let conjunto = palavras[i];

    // Tenta juntar palavras se não for número
    let next = palavras[i + 1] || '';
    let joined = conjunto + ' ' + next;

    let sigla = encontrarSigla(conjunto) || encontrarSigla(joined);

    if (sigla) {
      let valor = null;

      // Se achou na junção, pula a próxima palavra
      if (sigla === encontrarSigla(joined)) {
        i++;
      }

      // Verifica próximos até achar número
      for (let j = i + 1; j < palavras.length; j++) {
        if (/^[\d.,]+$/.test(palavras[j])) {
          valor = palavras[j].replace(',', '.');
          i = j;  // avança índice
          break;
        }
      }

      if (valor && !mapa[sigla]) {
        mapa[sigla] = valor;
      }
    }
  }

  const ordem = ['HB', 'HCT', 'LEUCO', 'PLT', 'INR', 'TTPA', 'TAP', 'RR',
                 'U', 'CR', 'NA', 'K', 'PCR', 'GLI', 'AST', 'ALT', 'TSH', 'T4', 'T3'];

  let resultado = ordem
    .map(sigla => mapa[sigla] ? `${sigla} ${mapa[sigla]}` : null)
    .filter(Boolean)
    .join(' ');

  document.getElementById('saida').textContent = resultado || "Nenhum valor reconhecido.";
}

function copiar() {
  const texto = document.getElementById("saida").textContent;
  navigator.clipboard.writeText(texto).then(() => {
    alert("Resultado copiado para a área de transferência!");
  });
}
</script>

<div class="footer-credit">by chatGPT e Leo.SS</div>
</body>
</html>
